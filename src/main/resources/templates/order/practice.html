<!DOCTYPE html>
<html lang="en">
<head>
    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
    <!-- iamport.payment.js -->
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>

        function requestPay() {
            IMP.init("imp11477517");
            IMP.request_pay({
                //Name과 amount 만 있어도 결제 진행 가능
                pg : 'kcp',
                pay_method : 'card',
                merchant_uid: "570191920230", //주문번호
                name : '당근 10kg',
                amount : 500, //숫자타입 (금액)
            }, function (rsp) { // callback
                if (rsp.success) {
                    console.log(rsp);
                    //결제 성공시: 결제 승인 또는 가상계좌 발급에 성공한 경우
                    //제이쿼리로 HTTP 요청
                    $.ajax({
                        url: "/order/payment/complete",
                        method: "POST",
                       // headers: { "Content-Type": "application/json" },
                        data: {
                            imp_uid: rsp.imp_uid,            // 결제 고유번호 (알아서 생성되는 것 같다????)
                            merchant_uid: rsp.merchant_uid   // 주문번호
                        }
                    }).done(function (data) {
                        // 가맹점 서버 결제 API 성공시 로직
                        //messageSend();
                        swal({
                            text: data,
                            closeOnClickOutside: false
                        })
                            .then(function () {
                                location.replace("/");
                            })
                    })//done
                        .fail(function (data){
                            alert("결제가 실패하였습니다.");
                            location.replace("/");
                        })
                } else {
                    //실패 로직
                    console.log(rsp);
                }
            });
        }
        /*]]>*/
    </script>
    <meta charset="UTF-8">
    <title>Sample Payment</title>
</head>
<body>
<div class="admin-content">
    회원
    <table>
        <thead>
        <tr>
            <th>예약번호</th>
            <th>항공번호</th>
            <th>회원번호</th>
            <th>수량</th>
            <th>금액</th>
            <th>예약날짜</th>
            <th>총금액</th>
        </tr>
        </thead>
        <tr th:each="rl : ${reservationList}">
            <td th:text="${rl.rno}"></td>
            <td th:text="${rl.ano}"></td>
            <td th:text="${rl.mno}"></td>
            <td th:text="${rl.arp_count}"></td>
            <td th:text="${rl.arp_price}"></td>
            <td th:text="${rl.arp_date}"></td>
            <td th:text="${rl.arp_count}*${rl.arp_price}"></td>
            </td>
            <td>
                <button onclick="requestPay()">결제하기</button>
            </td>
        </tr>
    </table>
</div>

<button onclick="requestPay()">결제하기</button> <!-- 결제하기 버튼 생성 -->
</body>
</html>